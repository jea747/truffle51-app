<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íŠ¸ëŸ¬í”Œ51 ì¹­ì°¬ ì•±</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 40px;
      font-size: 2.5em;
      color: #00ffc8;
      text-shadow: 2px 2px 5px #000;
    }
    .box {
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px #00ffc8;
      width: 90%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    input, button {
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 1em;
    }
    button {
      background: #00ffc8;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background: #00c6a2;
    }
    .hidden {
      display: none;
    }
    .info {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ğŸ€ íŠ¸ëŸ¬í”Œ51 ì¹­ì°¬ ì•±</h1>
  <div id="login" class="box">
    <input type="text" id="username" placeholder="ì•„ì´ë””" />
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <button onclick="login()">ë¡œê·¸ì¸</button>
    <p id="loginMsg"></p>
  </div>
  <div id="main" class="box hidden">
    <p id="greeting"></p>
    <div id="buttons"></div>
    <p class="info" id="status"></p>
    <button onclick="resetCount()">ì´ˆê¸°í™”</button>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <div id="adminPanel" class="box hidden">
    <h3>ğŸ“Š ì „ì²´ í•™ìƒ ì ìˆ˜</h3>
    <pre id="allScores"></pre>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <script>
    const users = {};
    for (let i = 1; i <= 23; i++) users[`user${i}`] = "123";
    users["rlarjsxo"] = "1q2w3e4r!"; // ì„ ìƒë‹˜

    const managers = {
      "ìš°ìœ  ë§ˆì…¨ë‹¤!": ["user10", "user19"],
      "ë°œí‘œí–ˆë‹¤!": ["user3"],
      "ì–‘ì¹˜í–ˆë‹¤!": ["user3"],
      "ì¹­ì°¬í–ˆë‹¤!": ["user3"],
      "ê¸‰ì‹ ë‹¤ ë¨¹ì—ˆë‹¤!": ["user6"]
    };

    const actions = {
      "ìš°ìœ  ë§ˆì…¨ë‹¤!": "ìš°ìœ ë¥¼ ë§ˆì‹œë‹¤ë‹ˆ ê±´ê°•í•´!",
      "ë°œí‘œí–ˆë‹¤!": "ë°œí‘œë¥¼ ì˜ í•´ëƒˆêµ¬ë‚˜!",
      "ì–‘ì¹˜í–ˆë‹¤!": "ê¹¨ë—í•œ ì´ê°€ ë°˜ì§!",
      "ì¹­ì°¬í–ˆë‹¤!": "ë”°ëœ»í•œ ë§ì„ ê±´ë„¸êµ¬ë‚˜!",
      "ê¸‰ì‹ ë‹¤ ë¨¹ì—ˆë‹¤!": "í¸ì‹ ì•ˆ í•´ì„œ í›Œë¥­í•´!",
    };

    const now = new Date();
    const currentPeriod = `${now.getFullYear()}-${Math.floor(now.getMonth() / 2)}`;
    const loginBox = document.getElementById("login");
    const mainBox = document.getElementById("main");
    const adminPanel = document.getElementById("adminPanel");
    const buttonsDiv = document.getElementById("buttons");
    const statusText = document.getElementById("status");
    const loginMsg = document.getElementById("loginMsg");

    let data = JSON.parse(localStorage.getItem("truffle-data") || "{}");
    let currentUser = null;

    function saveData() {
      localStorage.setItem("truffle-data", JSON.stringify(data));
    }

    function login() {
      const id = document.getElementById("username").value;
      const pw = document.getElementById("password").value;
      if (users[id] === pw) {
        currentUser = id;
        if (!data[id]) data[id] = { count: 0, last: {}, history: {}, period: currentPeriod };
        if (data[id].period !== currentPeriod) {
          data[id].history[data[id].period] = data[id].count;
          data[id].count = 0;
          data[id].last = {};
          data[id].period = currentPeriod;
          saveData();
        }
        loginBox.classList.add("hidden");
        if (id === "rlarjsxo") {
          showAdmin();
        } else {
          mainBox.classList.remove("hidden");
          document.getElementById("greeting").innerText = `${id}ë‹˜ í™˜ì˜í•´ìš”!`;
          updateStatus();
          showButtons();
        }
      } else {
        loginMsg.innerText = "ë¡œê·¸ì¸ ì‹¤íŒ¨!";
      }
    }

    function logout() {
      currentUser = null;
      loginBox.classList.remove("hidden");
      mainBox.classList.add("hidden");
      adminPanel.classList.add("hidden");
    }

    function showButtons() {
      buttonsDiv.innerHTML = "";
      for (const [label, message] of Object.entries(actions)) {
        const btn = document.createElement("button");
        btn.innerText = label;
        btn.onclick = () => handleClick(label, message);
        buttonsDiv.appendChild(btn);
      }
    }

    function handleClick(action, message) {
      const nowSec = Math.floor(Date.now() / 1000);
      const last = data[currentUser].last[action] || 0;
      if (nowSec - last < 36000) {
        alert("10ì‹œê°„ í›„ì— ë‹¤ì‹œ ëˆ„ë¥¼ ìˆ˜ ìˆì–´ìš”!");
        return;
      }
      const mgrs = managers[action] || [];
      if (!mgrs.includes(currentUser)) {
        alert(`ì´ í–‰ë™ì€ ê´€ë¦¬ì(${mgrs.join(", ")})ë§Œ ìŠ¹ì¸í•  ìˆ˜ ìˆì–´ìš”.`);
        return;
      }
      data[currentUser].last[action] = nowSec;
      data[currentUser].count++;
      saveData();
      alert(message);
      updateStatus();
    }

    function resetCount() {
      data[currentUser].history[data[currentUser].period] = data[currentUser].count;
      data[currentUser].count = 0;
      data[currentUser].last = {};
      saveData();
      updateStatus();
    }

    function updateStatus() {
      const count = data[currentUser].count;
      const history = data[currentUser].history || {};
      const grade = getRating(count);
      const scores = Object.entries(data).map(([u, d]) => [u, d.count]);
      scores.sort((a, b) => b[1] - a[1]);
      const rank = scores.findIndex(([u]) => u === currentUser) + 1;
      const historyStr = Object.entries(history).map(([p, c]) => `${p}: ${c}ì `).join("\n");
      statusText.innerText = `í˜„ì¬ ì ìˆ˜: ${count}ì \në“±ìˆ˜: ${rank}ë“±\në“±ê¸‰: ${grade}\nì§€ë‚œ ê¸°ë¡:\n${historyStr}`;
    }

    function showAdmin() {
      adminPanel.classList.remove("hidden");
      const output = Object.entries(data).map(
        ([u, d]) => `${u}: ${d.count}ì , ì´ì „ ê¸°ë¡: ${JSON.stringify(d.history)}`
      ).join("\n");
      document.getElementById("allScores").innerText = output;
    }

    function getRating(c) {
      if (c >= 100) return "1ë“±ê¸‰";
      if (c >= 90) return "2ë“±ê¸‰";
      if (c >= 80) return "3ë“±ê¸‰";
      if (c >= 70) return "4ë“±ê¸‰";
      if (c >= 60) return "5ë“±ê¸‰";
      if (c >= 50) return "6ë“±ê¸‰";
      if (c >= 40) return "7ë“±ê¸‰";
      if (c >= 30) return "8ë“±ê¸‰";
      return "9ë“±ê¸‰";
    }
  </script>
</body>
</html>
